sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{onPress:function(e){debugger;let t;let r;const o=e.getParameter("value");const s=parseInt(o);const n=e.getSource().getBindingContext();const a=parseFloat(n.getProperty("actualPrice"));const i=parseInt(n.getProperty("taxPercentage"));const g=n.getProperty("isChecked");const c=n.getProperty("band")?.match(/\(([\d.]+)%\)/);let l=c?.[1]?parseFloat(c[1]):0;if(l>0){if(s>0&&g)l=l+s;t=a*((100-l)/100);if(s>0&&!g)t=t-s}else if(s>0&&g){t=a*((100-s)/100)}else if(s>0&&!g){t=a-s}r=t+t*(i/100);n.setProperty("discountedPrice",t.toString());n.setProperty("totalPrice",r.toString());if(g){n.setProperty("discount",`${o}%`)}else if(!g){n.setProperty("discount",o)}},formatter:{formatText:function(e){if(e?.includes("%")){return e.slice(0,-1)}return e}},validateDiscount:async function(e){const t=e.getSource();let r=t.getValue();if(/^0+(?=[1-9])/.test(r)||/^0+\d+/.test(r)&&!r.startsWith("0.")){r=r.replace(/^0+/,"");t.setValue(r);return}if(/[^0-9.]/.test(r)||r.match(/\./g)?.length>1||/^\d*\.\d{3,}$/.test(r)){r=r.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/g,"$1").replace(/^(\d*\.\d{2}).*/,"$1");t.setValue(r);sap.m.MessageToast.show("Please enter a valid number with up to 2 decimal places.");return}let o;let s;let n=e.getSource().getParent().getParent().getParent().getParent().getParent().getBindingContext();let a=e.getParameter("value");let i=parseFloat(a?a:"0");const g=e.getSource().getBindingContext();const c=parseFloat(g.getProperty("actualPrice"));const l=parseFloat(g.getProperty("taxPercentage"));const u=g.getProperty("isChecked");const p=g.getProperty("band")?.match(/\(([\d.]+)%\)/);let d=p?.[1]?parseFloat(p[1]):0;let P=c*(d/100);let f=g.getProperty("discount");f=f.includes("%")?f.slice(0,-1):f;if(u&&i+d>=100){t.setValue(f);sap.m.MessageToast.show("The discount percentage cannot exceed 100.");return}if(!u&&i+P>=c){t.setValue(f);sap.m.MessageToast.show("Discount value cannot exceed Actual Price.");return}if(d>0){if(i>0&&u)d=d+i;o=c*((100-d)/100);if(i>0&&!u)o=o-i}else if(i>0&&u){o=c*((100-i)/100)}else if(i>0&&!u){o=c-i}else{o=c}s=o+o*(l/100);g.setProperty("discountedPrice",o.toFixed(2).toString());g.setProperty("totalPrice",s.toFixed(2).toString());let y=0;let m=0;let x=0;debugger;var F=e.getSource().getParent().getParent().getParent().getRows();for(const e of F){debugger;const t=e.getCells?e.getCells():e.getAggregation("content");debugger;var h=parseFloat(t[5].getContent().mAggregations.contentDisplay.getText());var S=parseFloat(t[9].getContent().mAggregations.contentDisplay.getText());var T=parseFloat(t[11].getContent().mAggregations.contentDisplay.getText());if(h&&S&&T){y=y+S;m=m+(T-S)}}x=y+m;n.setProperty("totalAmount",y.toFixed(2).toString());n.setProperty("taxAmount",m.toFixed(2).toString());n.setProperty("grandTotal",x.toFixed(2).toString());if(a===""||a==="0"){g.setProperty("discount",a)}else if(u){g.setProperty("discount",`${a}%`)}else if(!u){g.setProperty("discount",a)}setTimeout(()=>{},2e3)}}});
//# sourceMappingURL=Discount.js.map